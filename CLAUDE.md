# ABAnalytics 開発ガイドライン

本ドキュメントは、ABAnalyticsプロジェクトにおける開発の進め方と技術的な指針を定めたものである。

## 🔄 開発ワークフロー

### 📋 Phase 1: 計画立案（GitHub Issue）
開発は必ず計画の作成から始める。計画と実装を明確に分離することで、手戻りを防ぎ、品質を確保する。

**Issue作成時の必須項目：**
- [ ] **WHY（なぜ）** - 課題の背景と解決の必要性
  - 現状の問題点
  - ビジネス上の価値
  - 技術的な改善点
- [ ] **WHAT（何を）** - 具体的な実装内容
  - 変更対象のファイル・機能
  - 技術的アプローチ
  - 実装の範囲と制約
- [ ] **受け入れ条件（Acceptance Criteria）**
  - 機能要件の明確な定義
  - テストケースの概要
  - 完了の判断基準（計測可能な形で）

### ✅ Phase 2: レビューと承認
- [ ] 作成したIssueの内容確認
- [ ] ユーザーからの明示的な「実行していい」承認を待つ
- [ ] 承認なしに実装を開始しない

### 🛠️ Phase 3: 実装作業

#### 実装開始前
- [ ] **MUST**: GitHub Issueを必ず参照し、計画内容を確認
- [ ] 受け入れ条件を再確認
- [ ] 必要なテストケースを明確化

#### 実装中
- [ ] 定期的にIssueの計画と照合
- [ ] t_wadaのTDD原則に従う
- [ ] 型安全性と宣言的プログラミングを意識

#### 計画変更が必要な場合
1. GitHub Issueに変更内容を記載（コメントまたは本文更新）
2. 変更理由と影響範囲を明記
3. ユーザーに確認を求める
4. 承認後、更新されたIssueを参照して実装継続
5. **MUST**: 全ての変更履歴をIssueに記録

### 🚀 Phase 4: 完了確認とデプロイ準備
- [ ] 受け入れ条件を満たしているか確認
- [ ] `pnpm build && docker compose run test` の実行と成功確認
- [ ] コミットの作成（詳細は後述）
- [ ] **MUST**: pushは明示的な指示がある場合のみ実行

## 💻 実装時の技術指針

### 開発手法
- [ ] テスト駆動開発: t_wadaのTDD原則
- [ ] テスト実装: Kent C. Doddsの推奨する方法
- [ ] React実装: Dan Abramovの推奨する方法
- [ ] Next.js実装: Tim NeutkensとSebastian Markbågeの推奨する方法

### TypeScript型安全性
型システムを最大限活用し、実行時エラーを防ぐ。

- [ ] **MUST**: `any`型の使用は絶対禁止
- [ ] `unknown`型 + 型ガードで安全に処理
- [ ] 複雑な型は明示的に定義
- [ ] ユニオン型・ジェネリクスの積極活用

### 宣言的プログラミング
読みやすく保守しやすいコードを実現する。

- [ ] 命令的 < 宣言的な実装
- [ ] 高階関数（map, filter, reduce）の活用
- [ ] 純粋関数中心の設計
- [ ] 早期リターンでネストを浅く

### コード品質基準
- [ ] 単一責任の原則（SRP）
- [ ] 可読性優先（必要に応じてコメント追加）
- [ ] 適切なエラーハンドリング
- [ ] 具体的なエラーメッセージ

### コミット規約
- [ ] 機能・修正単位で適切に分割
- [ ] コミットメッセージに変更の意図を明記
- [ ] WIPコミットは作成しない
- [ ] **MUST**: コミット前に全テストが通ることを確認

## 📢 作業完了時の通知

タスク完了時は、以下の手順で報告を行う。

### Slack通知（#abanalytics チャンネル）
**MUST**: タスク完了時に一度だけ送信

**レポート必須項目：**
- <@U018M3K7NSW> メンション（通知音を鳴らすため）
- 完了タスクの概要
- WHY（なぜ変更したか）
- WHAT（何を変更したか）
- 変更ファイルの相対パス（例: `src/app/action.ts`）
- 各ファイルの修正内容の概要

**Slack記法：**
- 太字: *テキスト*
- コード: `コード`
- コードブロック: ```コード```
- リスト: • または -
- 見出し: 絵文字 + *太字*（例: 🚀 *デプロイ完了*）

**よく使う見出し絵文字：**
- 📊 分析・統計
- 🚀 リリース・デプロイ
- 🛠️ 修正・メンテナンス
- ✨ 新機能
- 🐛 バグ修正
- 📝 ドキュメント
- ⚡ パフォーマンス
- 🔧 設定・構成

### システム通知
**YOU MUST**: Slack送信後に実行
```bash
afplay /System/Library/Sounds/Funk.aiff
```

---

本ガイドラインに従うことで、計画的で品質の高い開発を実現する。各フェーズで必要な確認を行い、透明性の高い開発プロセスを維持すること。